---
title: "Survey Results"
output: html_notebook
---

# Evaluating Survey Results

## Setup

```{r}
rm(list = ls()) # clean workspace

library(ggplot2)
library(tidyverse)

# set local working directory -> change this to your path

setwd(r"(C:/AsAd/Python_Related/Applied_Statistics/AppliedStatistics/week01)")
```

## Loading the table

```{r}
survey <- read.csv("Week1_Survey_Results.csv", header = TRUE, sep = ",")
```

## Clean the Data

```{r}
# select all coffee drinkers and remove trailing and leading whitespaces
filtered_survey <- survey |>
  filter(Drinks.Coffee == 'Y') |>
  mutate(across(where(is.character), str_trim))

view(filtered_survey)

location_mapping <- c("B" = "Cafe ZessP",
                      "Cafe Zess" = "Cafe ZessP",
                      "I" = "Mensa")


# replace location B and other variants with Cafe ZessP
filtered_survey <- filtered_survey |>
  mutate(Location = case_match(Location,
                              "B" ~ "ZessP",
                              "Zess Cafe" ~ "ZessP",
                              "I" ~ "Mensa",
                              "mensa cafeteria" ~ "Mensa",
                              "Cafe im Grünen" ~ "CiG",
                              "Green" ~ "CiG",
                              "Sofa Cafe" ~ "Sofa",
                              "Campus shop" ~ "Campus Shop",
                              .default = Location))


all_semesters <- survey$Semester
semesters <- filtered_survey$Semester
locations <- filtered_survey$Location 
ratings <- filtered_survey$Rating
types <- filtered_survey$Type
reasons <-filtered_survey$Reason

```

## View the Data

### Barplots

```{r}
barplot(table(survey$Drinks.Coffee))

# hist(survey$Semester, breaks = seq(0, 20, 1))
# hist(survey$Rating, breaks = seq(0, 5, 1))

barplot(table(all_semesters))
barplot(table(ratings))
barplot(table(reasons))

# Where do students get their coffee from?
png("Presentation/Popular_Coffee_Locations.png", width = 1400, height = 1200)

par(mar = c(5, 8, 5, 2))  

barplot(
  table(locations),
  main = "Popular Coffee Locations on Campus",
  ylab = "No. of Students",   
  cex.lab = 2.0,                
  las = 1,                       
  cex.names = 1.6,              
  cex.main = 3,                  
  cex.axis = 1.8,                
  ylim = c(0, max(table(locations)) + 5),
  col = "#8BC34A"
)

dev.off()
```

## Analyze the data

### How are the Locations rated and visited?

```{r}
# What too much GPT does to a script

reason_counts <- filtered_survey %>%
  group_by(Location, Reason) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(Location) %>%
  mutate(reason_percent = count / sum(count)) %>%
  ungroup()

location_summary <- filtered_survey |>
  group_by(Location, Reason) |>
  summarise(
    mean_rating = mean(Rating, na.rm = TRUE),
    mean_semester = mean(Semester, na.rm = TRUE),
    N = n(),
    .groups = "drop"
  ) |>
  arrange(desc(mean_rating))

plot_data <- location_summary %>%
  left_join(reason_counts %>% select(Location, Reason, reason_percent),
            by = c("Location", "Reason")) %>%
  mutate(segment_height = mean_rating * reason_percent)

print(plot_data)

library(forcats)
plot_data <- plot_data %>%
  mutate(Location = fct_rev(fct_reorder(Location, segment_height, .fun = sum)))


colored_barplot <- ggplot(plot_data, aes(x = Location, y = segment_height, fill = Reason)) + 
  geom_bar(stat = "identity") + 
  theme_minimal() +
  geom_text(aes(label = N),                      # use N as label
          position = position_stack(vjust = 0.5),
          size = 3,
          color = "white") + 
  scale_fill_manual(
    values = c("Q" = "#1b9e77", "C" = "#d95f02", "P" = "#7570b3"),
    labels = c("Q" = "Quality", "C" = "Convenience", "P" = "Price")
  ) +
  labs(
    title = "Mean Ratings per Location with Reasons",
    x = "Location",
    y = "Mean Rating",
    fill = "Reason in % \nwith N answers"
)

ggsave("Presentation/Location_Ratings.png",
       width = 7,
       height = 4,
       plot = colored_barplot,
       dpi = 300)


# not coloring the bars is significantly simpler
location_stats <- filtered_survey |> 
  group_by(Location) |>
  summarize(
    mean_rating = mean(Rating),
    mean_semester = mean(Semester),
    N = n()) |>
  arrange(desc(mean_rating))

barplot(location_stats$mean_semester,
        names.arg = location_stats$Location,
        ylab = "Mean Semester",
        main = "Mean Semester by Location",
        las = 2)





```

### How do the semesters correspond to the Students Ratings

```{r}
semester_rating <- filtered_survey |>
  group_by(Semester) |>
  summarize(mean_rating = mean(Rating), N = n(), .groups = "drop")

print(semester_rating)

ggplot(semester_rating, aes(x = Semester, y = mean_rating)) +
  geom_point(size = 3, color = "#2196F3", alpha = 0.7) +
  geom_smooth(method = "lm", color = "#E91E63", se = TRUE, linewidth = 1) +
  labs(title = "Testing our Hypothesis: Do Students Who Have Studied Longer Rate Their Coffee Higher?",
       subtitle = "Average Rating per Semester with linear trend", y = "Mean Coffee Rating", x = "Semester") + theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 12, hjust = 0.5),
    plot.subtitle = element_text(size = 10, hjust = 0.5)
  ) +
  ylim(0, 5) 
ggsave("Presentation/semester_vs_rating.png",
       width = 8, height = 5, dpi = 300)
```

### Mean Location Rating in relation to the amount of mentions N

```{r}
ggplot(location_stats, aes(x = N, y = mean_rating)) +
  geom_point() +
  geom_smooth(method = "lm", color = "red") +
  labs(title = "Mean Location Rating in relation with the amount of mentions N",
       x = "Number of mentions (N)",
       y = "Mean Rating") +
  theme_minimal()
```
#Average Coffee Rating by Location
```{r}
avg_rating <- filtered_survey %>%
  group_by(Location) %>%
  summarise(mean_rating = mean(Rating, na.rm = TRUE),
            n = n())
ggplot(avg_rating, aes(x = reorder(Location, mean_rating), y = mean_rating, fill = n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Average Coffee Rating by Location",
       x = "Location", y = "Mean Rating") +
  scale_fill_gradient(low = "#FFD54F", high = "#D32F2F") +
  theme_minimal()

ggsave("Presentation/avg_rating_plot.png",
       width = 8, height = 5, dpi = 300)
```
```{r}
ggplot(semester_rating, aes(x = Semester, y = mean_rating)) +
  geom_point(size = 3, color = "#2196F3", alpha = 0.7) +      # larger, transparent blue points
  geom_smooth(method = "lm", color = "#E91E63", se = TRUE, linewidth = 1) +  # red trendline with confidence area
  labs(
    title = "Do Students Who Have Studied Longer Rate Their Coffee Higher?",
    subtitle = "Average Coffee Rating per Semester with Linear Trend",
    y = "Mean Coffee Rating (1–5)",
    x = "Semester"
  ) +
  theme_minimal(base_size = 14) +  # slightly larger base font for slides
  theme(
    plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
    plot.subtitle = element_text(size = 12, hjust = 0.5)
  ) +
  ylim(0, 5) 
```

